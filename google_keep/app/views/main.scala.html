@(Welcome:String,Token:String)
<!DOCTYPE html>
<html lang="en">
<style>
	.fa:hover{
		cursor: pointer;
	}
	.dark-shadow{
		-webkit-box-shadow: -2px 10px 18px 0px rgba(0,0,0,0.75);
-moz-box-shadow: -2px 10px 18px 0px rgba(0,0,0,0.75);
box-shadow: -2px 10px 18px 0px rgba(0,0,0,0.75);
	}
	.light-shadow{
		-webkit-box-shadow: -3px 4px 13px -7px rgba(0,0,0,0.75);
-moz-box-shadow: -3px 4px 13px -7px rgba(0,0,0,0.75);
box-shadow: -3px 4px 13px -7px rgba(0,0,0,0.75);

	}
</style>
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame 
       Remove this if you use the .htaccess -->
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<!-- jQuery-->
<script src="assets/internals/jQuery.js"></script> 
<link rel="stylesheet" href="assets/internals/jquery-ui.css">			
<script src="assets/internals/jquery-ui.js"></script>  
			  
			  
			  
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="assets/internals/bootstrap4.min.css" >


<!-- Latest compiled and minified JavaScript -->
<script src="assets/internals/bootstrap4.min.js"></script>

  <link href='assets/internals/roboto.css' rel='stylesheet' type='text/css'>
  <link href='assets/internals/Montserrat.css' rel='stylesheet' type='text/css'>
  <link href='assets/internals/PT Serif.css' rel='stylesheet' type='text/css'>
  
  <!-- Notify.js Files -->
  <script src="assets/internals/notify.min.js"></script>
  <link rel="stylesheet" href="assets/internals/notify-metro.min.css" type="text/css"/>
  <script src="assets/internals/notify-metro.min.js"></script>

<!-- Angular JS&routes -->
<script src="assets/internals/angular.min.js"></script>
<script type="text/javascript" src="assets/internals/angular-route.min.js"></script>

<!-- Font awesome script -->
<script src="assets/internals/font-awesome-025cac6ad7.js"></script>

<!-- time picker -->
<script src="assets/timepicker/js/bootstrap-timepicker.js"></script>
<link rel="stylesheet/less" href="assets/timepicker/css/timepicker.less"/>

  <title>@Welcome</title>
  <meta name="description" content="">
  <meta name="author" content="zemoso">

  <meta name="viewport" content="width=device-width; initial-scale=1.0">

  <!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>

<body ng-app="user_main" style="background:#F2F2F2">
  <div style="left:0px;top:0px;width: 100%;height: auto;position: absolute;">
  	<div style="z-index:100;left:0px;top:0px;width: 100%;height:10%;position: fixed;background:#EDC82E;">
  			<div style="left:0px;top:0px;left:0px;width:auto;position: absolute">
  				<p style="font-family: Roboto;font-size: 30px;color:white;">Notes &#64; Zemoso</p>	
  			</div>
  			<div>
  				<span style="float:right;right:10px;top:10px;position:absolute">
  				<a href="logout">Logout</a>
				</span>
  			</div>
  			
  	</div>
  	<div style="left:0px;top:0px;width: 100%;height:90px;position: absolute;background: #D2AE29"></div>
  	<div style="left:0px;top:90px;width: 100%;height:auto;">
  		<div ng-view>
  			
  		</div>
  		
  		
  		  <div id="leftMenu" class="well" style="left:0px;top:90px;width:18%;height:auto;position: fixed">
  			<div style="margin-top:10%;left:0px;height:400px;">
  				<ul class="nav nav-pills nav-stacked">
				  <li class="nav-item">
				    <a class="nav-link" id="home"  href="#home">Home</a>
				  </li>
				  <li class="nav-item">
				    <a class="nav-link" id="archive" href="#archive">Archives</a>
				  </li>
				</ul>
  			</div>
  			
  		</div>
  	</div>
  </div>
  
  <!-- reminder updater dialog box -->
<div id="dialog" title="Basic dialog">
  <p>This is the default dialog which is useful for displaying information. The dialog window can be moved, resized and closed with the 'x' icon.</p>
</div>


</body>
<script>
	/**
	 * User access token generated by server and posted 
	 * on to client, used to get and post data of THE USER
	 */
	var token="@Token";
	/**
	 * Interval variable
	 */
	var inter=setInterval(compare,1000);
	/**
	 * Start interval
	 */
	inter;														
	var script_start_time=new Date().getTime();  	/**
													 * get time when script started execution
													 */
	var timings=[];									
	
	/**
	 * Get reminders from server and then run compare function
	 */
	function getReminders(){
		$.ajax({
			url:"/getReminders",
			type:"GET",
			headers:{
				"Authorization":token,
				"Content-Type":"application/json"
			},
			success:function(data){
				timings=data;
			}
		});	
	}
	
	/**
	 * 	update reminder trigger activity, in database
	 * 	when a reminder is triggered, then it's alerted,
	 *  then it should be marked as inactive in Databse
	 */
	function updateThisReminder(timings){
		$.ajax({
			url:"/setReminder?postId="+timings['postId'],
			type:"GET",
			headers:{
				"Authorization":token,
				"Content-Type":"application/json"
			},
			dataType:'json',
			success:function(data){
				var x_1=Number.parseInt(timings['reminder']);
				var user_date=new Date(x_1);
				var print_out="Reminder: "+((user_date.getMonth()+1)+"/"+user_date.getDate()+"/"+(1900+user_date.getYear()))+" \n"+timings['title'];
				getReminders();
				if(timings['isArchive']==1){
					window.location.href="main#/archive"
				}
				else{
					window.location.href="main#/home"
				}
				alert(print_out);
			}
		});	
	}
	
	/**
	 * Compare function is used to compare present timestamp to 
	 * the reminder's date and time if times match trigger the event of alert
	 */
	function compare(){
		var current_time=(new Date().getTime());
		var len=timings.length;
		for(var i=0;i<len;i++){
			var x_1=Number.parseInt(timings[i]['reminder']);
			if(x_1>script_start_time&&x_1<=current_time){
				var title=timings[i]['title'];
				var user_date=new Date(x_1);
				updateThisReminder(timings[i]);
			}
		}
	}
	
	
	
	
	
	

	
	/**
	 * Main app with ngRoute dependency
	 */
	var m_app=angular.module("user_main",['ngRoute']);
	/**
	 * routing angularJS application with two views 1)home page 2)archive page
	 * and their respective controllers
	 */
	m_app.config(function($routeProvider){
		$routeProvider
			.when('/home',{templateUrl:'home',controller:'homeController'})
			.when('/archive',{templateUrl:'archive',controller:'archiveController'})
			.otherwise({redirectTo:'/home'});
	});
	
	
	
	
	
	/**
	 * Services Common to all the controllers under main app
	 */
	m_app.service('servicesContainer',function($http){
		
		/**
		 * get notes of a particular user with respect to isArchive flag
		 * isArchive=1 means get archived data
		 * isArchive=0 means get un-archived data
		 */
		this.get_contents=function(isArchive){
			var output=$http.get(
				"@routes.HomeController.getAllPosts"+"?isArchive="+isArchive,
				{
					headers:{
						"Authorization":token,"Content-Type":"application/json"
					}
				}
			)
		//return the $http itself for success and error calls		
		return output;
		};
		
		
		/**
		 * Archive or un-archive a particular post with respect to it's id and flag
		 * id-> id of the post
		 * flag->{ 0: means un-archive, 1: archive }
		 */
		this.archiveThisPost=function(postId,flag){
			var output=$http.post("@routes.HomeController.archivePostById",
			{"postId":postId,"flag":flag},
			{
				headers:{
							"Authorization":token,
							"Content-Type":"application/json"
						}
			}
			);
			return output;
		};
	
	
	});
	
	
	
	/**
	 * Controller of archive page
	 */
	m_app.controller("archiveController",function($scope,$http,servicesContainer){
		
		$("#home").removeClass("active");
		$("#archive").addClass("active");
		/**
		 * get archived contents of a user with respect to his/her token
		 */
		$scope.get_contents=function(isArchive){
			var input=servicesContainer.get_contents(isArchive);
			input.success(function(data,status,headers,config){
				/**
				 * contents is a model in archive page
				 * which contains particulars of user's post such as 
				 * 1) id
				 * 2) title of post
				 * 3) content of the post
				 * 4) date of last update
				 * 5) reminder
				 * 6) archive flag
				 */
				$scope.contents=data;
				
			}).error(function(data,status,headers,config){
				console.log(status);
			});
			getReminders();
		};
		/**
		 * implict call to get contents of user when the page is loaded
		 * a flag of "1" is specified mentioning "fetch only archived data"
		 */
		$scope.get_contents(1);
		
		/**
		 * un-archives a particular post, triggered by a post's un-archived button
		 *
		 */
		$scope.archiveThisPost=function(postId,flag){
			var input=servicesContainer.archiveThisPost(postId,flag);
			input
			.success(function(data,status,headers,config){
				closeAllDivs();
				//generate a noitification saying post is un-archived
				$.notify("Note un-archived","info");
				/**
				 * get the new list of notes that are archived since 
				 * the call itself un-archives a post with id postId
				 */
				$scope.get_contents(1);
			})
			.error(function(data,status,headers,config){
				console.log(status);	
			});
		}
	});
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	/**
	 * controller for home page
	 */
	m_app.controller("homeController",function($scope,$http,servicesContainer,$interval){
		//global reminder variable
		var global_reminder_update="";
		/**
		 * models from pop_up_modal
		 */
		$scope.user_date_g="";
		$scope.user_time_g=""
		$scope.generic_title="";
		$scope.generic_content="";
		global_reminder_update="";
		
		/**
		 * Setting anchor to active
		 */
		$("#home").addClass("active");
		$("#archive").removeClass("active");
		
		
		
		
		/**
		 * get posts which are un-archived
		 */
		
		$scope.get_contents=function(isArchive){
			var input=servicesContainer.get_contents(isArchive);
			input.success(function(data,status,headers,config){
				/**
				 * contents is a model in home page
				 * which contains particulars of user's post such as 
				 * 1) id
				 * 2) title of post
				 * 3) content of the post
				 * 4) date of last update
				 * 5) reminder
				 * 6) archive flag
				 */
				$scope.contents=data;	
				
			}).error(function(data,status,headers,config){
				console.log(status);
			});
			
			/**
			 * Call to fetch all active reminders
			 */
			getReminders();
			
		};
		//implicit call to get posts which are marked as un-archive
		$scope.get_contents(0);
		
		/**
		 * archives a particular post with flag 1
		 */
		$scope.archiveThisPost=function(postId,flag){
			if(postId==""){
				var isReminderActive=1;
				if(global_reminder_update!=""){
					isReminderActive=0;
				}
				$scope.post_contents(1,isReminderActive);
			}
			else{
				var input=servicesContainer.archiveThisPost(postId,flag);
				input
				.success(function(data,status,headers,config){
					closeAllDivs();
					//generate a noitification saying post is archived
					$.notify("Note archived","info");
					/**
					 * get the new list of notes that are un-archived since 
					 * the call itself archives a post with id postId
					 */
					$scope.get_contents(0);
				})
				.error(function(data,status,headers,config){
					console.log(status);	
				});	
			}
			
		}
		
		/**
		 * triggered by modal's submission
		 * submits either archived or un-archived post depends which depends on isArchive flag
		 */
		$scope.post_contents=function(isArchive,isReminderActive){
			if($scope.generic_title!=""|$scope.generic_content!=""|global_reminder_update!=""){
				$http.post(
					"@routes.HomeController.addPost",
					{
						"title":$scope.generic_title,"content":$scope.generic_content,"isArchive":isArchive,"reminder":global_reminder_update,"isReminderActive":isReminderActive
					},
					{
						headers:{
								"Authorization":token,"Content-Type":"application/json"
								}
					}
				).success(function(data, status, headers, config){
						if(isArchive==1){
							$.notify("Note archived","success");
							
						}
  						console.log(status);	
  						$scope.get_contents(0);
  					})
  				.error(function(data, status, headers, config){
  					console.log(status+" "+data);
  				});
				$scope.user_date_g="";
				$scope.user_time_g=""
				$scope.generic_title="";
				$scope.generic_content="";
				global_reminder_update="";
				closeAllDivs();
			}
			
		};
		
		
		
		
		/**
		 * Triggered by ng-click on Save reminder button of pop_up_modal
		 */
		$scope.popUpDiv=function(container){
			$("#genericModal").modal('show');
			$scope.generic_title=container['title'];
			$scope.generic_content=container['content'];
			$scope.createdDate="Last edited at "+container['date'];
			$scope.postId=container['postId'];
			global_reminder_update=container['reminder'];
			var user_date_c=Number.parseInt(container['reminder']);
			var date=new Date(user_date_c);
			$scope.user_date_g=(date.getMonth()+1)+"/"+(date.getDate())+"/"+(date.getYear()+1900);
			$scope.user_time_g=(date.getHours()+":"+date.getMinutes());
			$scope.prev_container=container;
			//If current container is equal to previous container -> give perms to update!
		}
		
		
		$scope.popUpPost=function(){
			$("#genericModal").modal('show');
			$scope.generic_title="";
			$scope.generic_content="";
			$scope.createdDate="";
			$scope.postId="";
			global_reminder_update="";
			$scope.user_date_g="";
			$scope.user_time_g="";
			$scope.prev_container="postId";
		}
		
		
		/**
		 * updateReminder ng-click on a particular post,
		 * pops up a reminder and then updates the reminder if it's valid else nope!
		 */
		$scope.updateReminder=function(container){
			var x=container['postId'];
			var new_date=$("#rem_date_"+x).val();
			var new_time=$("#rem_time_"+x).val();
			var new_date_time=new Date(new_date+" "+new_time).getTime();
			if(new_date_time<=new Date().getTime()){
				$.notify("Oops, the time is gone, we cannot bring it back!","warn");
				return;
			}
			else{
				$http.post(
				"@routes.HomeController.updateReminder",
				{"postId":x,"reminder":new_date_time},
				{
					headers:{
						"Authorization":token,
						"Content-Type":"application/json"
					}
				}
				).success(function(data,status,headers,config){
					$scope.get_contents(0);
					$.notify("Reminder updated","success");
						
			}).error(function(data,status,headers,config){
				console.log(status);
			});
				
			}
		}
		
		
		$scope.save_reminder_local_generic=function(){
			
			var user_gen_date=new Date($scope.user_date_g+" "+$scope.user_time_g).getTime();
			if(user_gen_date<=new Date().getTime()){
				$.notify("Cannot save that reminder","warn");
				return;
			}
			else{
				global_reminder_update=user_gen_date;
				$.notify("Reminder saved","info");
			}
		}
		
		
		
		/***
		 * Saves or updates a post depending up on the value of argument "prev_container"
		 * prev_container->{"postId":"Post NEW Data"}
		 * prev_container->{"array of data with postId not null":"Update the content"}
		 */
		$scope.generic_click=function(prev_container){
			if(prev_container=="postId"){
				var title=$scope.generic_title;
				var content=$scope.generic_content;
				var reminder=global_reminder_update;
				var isReminderActive=1;
				if(!isNaN(global_reminder_update)&&global_reminder_update!="") 
					isReminderActive=0;
				$scope.post_contents(0,isReminderActive);
			}
			else{
				if($scope.generic_title!=prev_container['title']|
			$scope.generic_content!=prev_container['content']|
			prev_container['reminder']!=global_reminder_update
			){
				var isReminderActive=1;
				if(prev_container['reminder']!=global_reminder_update&&!isNaN(global_reminder_update)&&global_reminder_update!="") 
					isReminderActive=0;
				$http.post("@routes.HomeController.updatePost",
				{
					"postId":prev_container['postId'],			
					"title":$scope.generic_title,
					"content":$scope.generic_content,
					"reminder":global_reminder_update,
					"isArchive":0,
					"isReminderActive":isReminderActive
				},
				{
					headers:{
						"Authorization":token,
						"Content-Type":"application/json"
					},
				}
				).success(function(data,status,headers,config){
				$scope.get_contents(0);
				$.notify("Note updated","info");
				closeAllDivs();
			}).error(function(data,status,headers,config){
				console.log(status);
			});
			}
				
				
			}
			
			
			
		}
	});
	
	/**
	 * save_reminder_local_generic
	 */
	
	function closeAllDivs(){
		$("#genericModal").modal("hide");
		$("#formModal").modal("hide");
	}
	
	function addShadow(id){
	$("#"+id).removeClass("light-shadow");
	$("#"+id).addClass('dark-shadow');
	}	
	function undoShadow(id){
		$("#"+id).removeClass('dark-shadow');
		$("#"+id).addClass("light-shadow");
		
	}
</script>
</html>
